#!/bin/hush
# Start up file for Asterisk

# NOTE: we set the TZ before starting as otherwise (when starting from
# /etc/rc) this env variable won't be available to the shell that
# starts Asterisk and the time will be messed up.

case $1 in
	start)  export TZ=`cat /etc/TZ`; 
		asterisk -f >/dev/null 2>/dev/null &;
		/usr/sbin/httpd;;
	stop) 	killall -9 asterisk;
		killall httpd;;
	restart) asterisk -rx "stop now";
                sleep 3;
		export TZ=`cat /etc/TZ`;
		asterisk -f >/dev/null 2>/dev/null & ;;
	enable) rm -f /persistent/etc/rc.d/S50asterisk; 
	        ln -s /persistent/etc/init.d/asterisk /persistent/etc/rc.d/S50asterisk;;
	disable) rm -f /persistent/etc/rc.d/S50asterisk;;
        *) echo 'Syntax: /etc/init.d/asterisk [command]'
	   echo ''
	   echo '	Available commands:'
           echo '		start   Start the service'
           echo '		stop    Stop the service'
           echo '		restart Restart the service'
           echo '		enable  Enable service autostart'
           echo '		disable Disable service autostart'
esac
