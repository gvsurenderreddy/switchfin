#!/bin/hush
# Start up file for Zaptel

ZAPTELCONF="/persistent/etc/zaptel.conf"
TMP=`grep  '^dchan' ${ZAPTELCONF}`
if [[ "`echo ${TMP}|grep '24'`" != "" ]]
then
T1E1MODE=1
else
T1E1MODE=2
fi

case $1 in
	start) modprobe wpr1 t1e1mode=$T1E1MODE;
	       ztcfg;;
	stop) modprobe -r wpr1;;
	restart) modprobe -r wpr1;
		modprobe wpr1 t1e1mode=$T1E1MODE;
		ztcfg;;
	enable) rm -f /persistent/etc/rc.d/S40zaptel; 
	        ln -s /persistent/etc/init.d/zaptel /persistent/etc/rc.d/S40zaptel;;
	disable) rm -f /persistent/etc/rc.d/S40zaptel;;
        *) echo 'Syntax: /etc/init.d/zaptel [command]'
           echo ''
           echo '       Available commands:'
           echo '               start   Start the service'
           echo '               stop    Stop the service'
           echo '               restart Restart the service'
           echo '               enable  Enable service autostart'
           echo '               disable Disable service autostart'
esac
